<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2019-01-09 Wed 18:06 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SAN: Location Optimizer</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Felix E. Klee" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2018 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="content">
<h1 class="title">SAN: Location Optimizer</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org94fe7ae">1. Abstract</a></li>
<li><a href="#org27ab302">2. Nodes</a></li>
<li><a href="#org2e35145">3. Current algorithm</a></li>
<li><a href="#orgcb2d345">4. Problem</a></li>
<li><a href="#org06ab623">5. Simulation</a></li>
<li><a href="#orgcf0d13d">6. Examples</a>
<ul>
<li><a href="#org8e3d051">6.1. 1:1 connection</a>
<ul>
<li><a href="#org25ec04b">6.1.1. Input</a></li>
<li><a href="#org31e5416">6.1.2. Example solution</a></li>
</ul>
</li>
<li><a href="#org2f75b42">6.2. Hexagon</a>
<ul>
<li><a href="#orgac3407c">6.2.1. Input</a></li>
<li><a href="#org4d1eff0">6.2.2. Example solution</a></li>
</ul>
</li>
<li><a href="#org05b99af">6.3. Pentagon</a>
<ul>
<li><a href="#org6d8097a">6.3.1. Example solution</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org94fe7ae" class="outline-2">
<h2 id="org94fe7ae"><span class="section-number-2">1</span> Abstract</h2>
<div class="outline-text-2" id="text-1">
<p>
The <i>location optimizer</i> takes all the data that is available and
tries to find the coordinates of the nodes in space.
</p>

<p>
Input:
</p>

<ul class="org-ul">
<li>which node is connected to which node and on which port,</li>

<li>tilt angle of nodes (optional).</li>
</ul>

<p>
Output:
</p>

<ul class="org-ul">
<li>coordinates of nodes in space,</li>

<li>tilt angle of spheres for display (optional).</li>
</ul>

<p>
The location optimizer does its calculations under the assumptions
that:
</p>

<ul class="org-ul">
<li>the distance of a connection is 1,</li>

<li>the angle between connections is the tetrahedral angle (≈ 109.5°).</li>
</ul>

<p>
The information here is only relevant for the version of SAN that was
current at the time this document was published.
</p>
</div>
</div>


<div id="outline-container-org27ab302" class="outline-2">
<h2 id="org27ab302"><span class="section-number-2">2</span> Nodes</h2>
<div class="outline-text-2" id="text-2">

<div id="org6374bf0" class="figure">
<p><img src="./images/geometry.png" alt="geometry.png" />
</p>
<p><span class="figure-number">Figure 1: </span>Geometry of a node with ports 1–4</p>
</div>

<p>
Properties of a node:
</p>

<ul class="org-ul">
<li>A node may also be called a <i>sphere</i>, referring to the physical
elements in the SAN construction kit.</li>

<li>There is one special node, the root node:

<ul class="org-ul">
<li>It connects the computer to the network.</li>

<li>It has one USB port that connects to the computer.</li>

<li>It has only one port: 1</li>

<li>It’s ID is: <code>^</code></li>
</ul></li>

<li>Non-root nodes have four ports: 1, 2, 3, and 4</li>

<li>Each non-root node has a unique ID: A–Z</li>

<li>A node’s <i>axis</i> is relevant if there is information about its tilt
angle. The tilt angle is measured by an accelerometer. As of this
writing there is only one sphere that contains an accelerometer.</li>
</ul>
</div>
</div>


<div id="outline-container-org2e35145" class="outline-2">
<h2 id="org2e35145"><span class="section-number-2">3</span> Current algorithm</h2>
<div class="outline-text-2" id="text-3">
<p>
A genetic algorithm is used to approximate the positions of the points
in space. This algorithm is called <i>location optimizer.</i> After
optimization, ideally all neighboring nodes have a distance of 1, and
the angles between the connecting vectors match those on the
spheres. The algorithm however is flexible enough to find solutions
even if distances or angles have been violated. See examples below.
</p>

<p>
Steps:
</p>

<ol class="org-ol">
<li><p>
<i>Initialize:</i> Generate a population \(P\) of \(n\) individuals. Each
individual is described by a chromosome. A chromosome contains a
list of coordinates. The coordinates describe a distribution of
points in space. Initially the coordinates are chosen randomly.
</p>

<p>
Example with nodes \(C\), \(B\), and \(D\) in the network:
</p>

\begin{equation}
P_1 = ((x_C, y_C, z_C, x_B, y_B, z_B, x_D, y_D, z_D))\\
P_2 = ((x_C, y_C, z_C, x_B, y_B, z_B, x_D, y_D, z_D))\\
…\\
P_n = ((x_C, y_C, z_C, x_B, y_B, z_B, x_D, y_D, z_D))
\end{equation}</li>

<li><i>Reproduce:</i>

<ol class="org-ol">
<li><i>Pair:</i> Randomly select pairs of individuals. These individuals
will act as parents in the next step.</li>

<li><i>Create offspring.</i> For each pair of parents:

<ol class="org-ol">
<li><i>Crossover:</i> Form a child chromosome by taking one part of
the chromosome from the first parent and the other part from
the second parent.</li>

<li><i>Mutate:</i> Randomly change coordinates in the child
chromosome.</li>
</ol></li>
</ol></li>

<li><p>
<i>Find fitness:</i> For each child determine how close the points in
the chromosome are to an optimal distribution. An optimal
distribution is one where:
</p>

<ul class="org-ul">
<li>the distance between each two nodes is 1,</li>

<li>the angle between each two connections from one node is the
tetrahedral angle.</li>
</ul>

<p>
The deviation to the optimal distribution is quantified as fitness
and assigned to each child.
</p></li>

<li><i>Natural selection:</i> Create a new population by combining:

<ul class="org-ul">
<li>the \(n - 1\) best children,</li>

<li>the best individual from the previous generation.</li>
</ul></li>

<li><i>Iterate:</i> go to step 2.</li>
</ol>
</div>
</div>


<div id="outline-container-orgcb2d345" class="outline-2">
<h2 id="orgcb2d345"><span class="section-number-2">4</span> Problem</h2>
<div class="outline-text-2" id="text-4">
<p>
Genetic algorithms tend to get stuck in local minima. In that case all
individuals have converged to the same non-optimal solution. Mutation
of single coordinates worsens the fitness of individuals, and so they
don’t carry over to the next generation. Evolution has stopped.
</p>
</div>
</div>


<div id="outline-container-org06ab623" class="outline-2">
<h2 id="org06ab623"><span class="section-number-2">5</span> Simulation</h2>
<div class="outline-text-2" id="text-5">
<p>
Assembling the structure can be simulated. This is useful for testing
the location optimizer without the physical construction kit.
</p>

<p>
Setup:
</p>

<ol class="org-ol">
<li>Install Node.js and the Yarn package manager.</li>

<li>Clone the SAN repository from: <a href="https://github.com/feklee/san/">https://github.com/feklee/san/</a></li>

<li><p>
Install all necessary dependencies and build the frontend (on
Windows call <code>rollup.cmd</code> instead of <code>rollup</code>):
</p>

<div class="org-src-container">
<pre class="src src-shell">$ cd webapp
$ yarn install
$ ./node_modules/.bin/rollup --config
</pre>
</div></li>

<li><p>
Start the simulation:
</p>

<div class="org-src-container">
<pre class="src src-shell">yarn start simulate
</pre>
</div></li>

<li><p>
Open the SAN web app: <a href="http://localhost:8080">http://localhost:8080</a>
</p>


<div class="figure">
<p><img src="./images/webapp-with-no-node.png" alt="webapp-with-no-node.png" />
</p>
</div>

<p>
To navigate in 3D in the canvas on the left side, use the mouse.
</p></li>

<li><p>
Go back to the command line and connect a node to the root node:
</p>

<div class="org-src-container">
<pre class="src src-text">+^1C1
</pre>
</div>

<p>
This connects port <code>C1</code> (port 1 on node C) with <code>^1</code> (port 1 on the
root node). The result is immediately visible in the web app.
</p>


<div class="figure">
<p><img src="./images/webapp-with-one-node.png" alt="webapp-with-one-node.png" />
</p>
</div>

<p>
On the top right side you see an adjacency matrix. The numbers in
the matrix refer to the connected ports. On the bottom righ side
you see a log of the information that the webapp receives from the
structure. On each line there is a timestamp on the left side. The
circle on the right means that there is no information about a tilt
angle for the connected node.
</p></li>

<li><p>
Add additional nodes:
</p>

<div class="org-src-container">
<pre class="src src-text">+C2B1
+B3D4
</pre>
</div>

<p>
This connects <code>B3</code> (port 3 on node B) to <code>C2</code> and <code>D4</code> to <code>B3</code>.
</p>


<div class="figure">
<p><img src="./images/webapp-with-three-nodes.png" alt="webapp-with-three-nodes.png" />
</p>
</div></li>
</ol>
</div>
</div>

<div id="outline-container-orgcf0d13d" class="outline-2">
<h2 id="orgcf0d13d"><span class="section-number-2">6</span> Examples</h2>
<div class="outline-text-2" id="text-6">
</div>
<div id="outline-container-org8e3d051" class="outline-3">
<h3 id="org8e3d051"><span class="section-number-3">6.1</span> 1:1 connection</h3>
<div class="outline-text-3" id="text-6-1">
<p>
Just two nodes connected.
</p>
</div>

<div id="outline-container-org25ec04b" class="outline-4">
<h4 id="org25ec04b"><span class="section-number-4">6.1.1</span> Input</h4>
<div class="outline-text-4" id="text-6-1-1">
<p>
Simulation:
</p>

<div class="org-src-container">
<pre class="src src-text">+^1A1
+A2B1
</pre>
</div>

<p>
Adjacency matrix (numbers are ports): <a href="./data/1-1-adjacency.tsv">1-1-adjacency.tsv</a>
</p>
</div>
</div>

<div id="outline-container-org31e5416" class="outline-4">
<h4 id="org31e5416"><span class="section-number-4">6.1.2</span> Example solution</h4>
<div class="outline-text-4" id="text-6-1-2">

<div class="figure">
<p><img src="./images/1-1.png" alt="1-1.png" />
</p>
</div>

<p>
Coordinates: <a href="./data/1-1-coordinates.tsv">1-1-coordinates.tsv</a>
</p>
</div>
</div>
</div>


<div id="outline-container-org2f75b42" class="outline-3">
<h3 id="org2f75b42"><span class="section-number-3">6.2</span> Hexagon</h3>
<div class="outline-text-3" id="text-6-2">
<p>
This is the smallest loop that can be built without violating the
tetrahedral angles.
</p>
</div>

<div id="outline-container-orgac3407c" class="outline-4">
<h4 id="orgac3407c"><span class="section-number-4">6.2.1</span> Input</h4>
<div class="outline-text-4" id="text-6-2-1">
<p>
Simulation:
</p>

<div class="org-src-container">
<pre class="src src-text">+^1A1
+A2B1
+B2C1
+C2D1
+D2E1
+E2F1
+F2A3
</pre>
</div>

<p>
Adjacency matrix (numbers are ports): <a href="./data/hexagon-adjacency.tsv">hexagon-adjacency.tsv</a>
</p>
</div>
</div>

<div id="outline-container-org4d1eff0" class="outline-4">
<h4 id="org4d1eff0"><span class="section-number-4">6.2.2</span> Example solution</h4>
<div class="outline-text-4" id="text-6-2-2">

<div class="figure">
<p><img src="./images/hexagon.png" alt="hexagon.png" />
</p>
</div>

<p>
Coordinates: <a href="./data/hexagon-coordinates.tsv">hexagon-coordinates.tsv</a>
</p>
</div>
</div>
</div>


<div id="outline-container-org05b99af" class="outline-3">
<h3 id="org05b99af"><span class="section-number-3">6.3</span> Pentagon</h3>
<div class="outline-text-3" id="text-6-3">
<p>
Simulation:
</p>

<div class="org-src-container">
<pre class="src src-text">+^1A1
+A2B1
+B2C1
+C2D1
+D2E1
+E2A3
</pre>
</div>

<p>
Adjacency matrix (numbers are ports): <a href="./data/pentagon-adjacency.tsv">pentagon-adjacency.tsv</a>
</p>

<p>
Note that the interior angles of a pentagon are 108° are close to but
not identical to the tetrahedral angle of 109.5°. Nevertheless the
algorithm is able to approximate a solution. Even for nodes connected
in a triangle it finds a solution!
</p>
</div>

<div id="outline-container-org6d8097a" class="outline-4">
<h4 id="org6d8097a"><span class="section-number-4">6.3.1</span> Example solution</h4>
<div class="outline-text-4" id="text-6-3-1">

<div class="figure">
<p><img src="./images/pentagon.png" alt="pentagon.png" />
</p>
</div>

<p>
Coordinates: <a href="./data/pentagon-coordinates.tsv">pentagon-coordinates.tsv</a>
</p>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Felix E. Klee</p>
<p class="date">Created: 2019-01-09 Wed 18:06</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
