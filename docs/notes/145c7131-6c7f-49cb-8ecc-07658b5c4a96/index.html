<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2019-01-22 Tue 12:42 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SAN: Location Optimizer</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Felix E. Klee" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<style>img{max-width:100%}.figure-number{display:none}</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2018 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="content">
<h1 class="title">SAN: Location Optimizer</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org7b9d1b3">1. Abstract</a></li>
<li><a href="#org3e452d5">2. Nodes</a></li>
<li><a href="#orgc003cf4">3. Genetic algorithm for location optimization</a>
<ul>
<li><a href="#org8e68dc0">3.1. Summary</a></li>
<li><a href="#orgf6b163a">3.2. Steps</a></li>
<li><a href="#orgf77982f">3.3. Problem</a></li>
<li><a href="#org0c16aea">3.4. Fitness</a>
<ul>
<li><a href="#org55e0321">3.4.1. Deviation of first neighbor</a></li>
<li><a href="#org38f9eed">3.4.2. Deviation of second neighbor</a></li>
<li><a href="#orge5bfeab">3.4.3. Deviations of third and fourth neighbor</a></li>
<li><a href="#org1e046fc">3.4.4. Total deviation</a></li>
<li><a href="#org94ca9b7">3.4.5. Note about the positions of the third and fourth neighbor</a></li>
</ul>
</li>
<li><a href="#org1d938b1">3.5. Alternative fitness proposal</a>
<ul>
<li><a href="#orge20ccc3">3.5.1. Distance</a></li>
<li><a href="#orge4f0247">3.5.2. Angle</a></li>
<li><a href="#org7ae6075">3.5.3. Chirality</a></li>
<li><a href="#orgd1b716f">3.5.4. Total fitness</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgd84a87c">4. Simulation</a></li>
<li><a href="#org051b1dd">5. Experimentation</a></li>
<li><a href="#org1ec70c6">6. Examples</a>
<ul>
<li><a href="#orgf8b7067">6.1. 1:1</a>
<ul>
<li><a href="#org3db42db">6.1.1. Input</a></li>
<li><a href="#orge08435f">6.1.2. Example solution</a></li>
</ul>
</li>
<li><a href="#orgf20f436">6.2. 1:4</a>
<ul>
<li><a href="#org561e255">6.2.1. Input</a></li>
<li><a href="#org66f572b">6.2.2. Example solution</a></li>
</ul>
</li>
<li><a href="#org17c22b6">6.3. Hexagon</a>
<ul>
<li><a href="#orga07c9dd">6.3.1. Input</a></li>
<li><a href="#orgb182968">6.3.2. Example solution</a></li>
</ul>
</li>
<li><a href="#org8fd49a4">6.4. Pentagon</a>
<ul>
<li><a href="#org1416f1f">6.4.1. Input</a></li>
<li><a href="#orgd82baea">6.4.2. Example solution</a></li>
</ul>
</li>
<li><a href="#org56304e1">6.5. Dodecahedron</a>
<ul>
<li><a href="#org0e4acd8">6.5.1. Input</a></li>
<li><a href="#org3ec0bcc">6.5.2. Example solution</a></li>
<li><a href="#orgae34f65">6.5.3. Example bad solution</a></li>
</ul>
</li>
<li><a href="#org437493a">6.6. Dodecahedron with tilt angles</a>
<ul>
<li><a href="#orge625876">6.6.1. Input</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org7b9d1b3" class="outline-2">
<h2 id="org7b9d1b3"><span class="section-number-2">1</span> Abstract</h2>
<div class="outline-text-2" id="text-1">
<p>
The <i>location optimizer</i> takes all the data that is available and
guesses the locations of the nodes in space.
</p>

<p>
Input:
</p>

<ul class="org-ul">
<li>which node is connected to which node and on which port,</li>

<li>tilt angles of nodes (optional).</li>
</ul>

<p>
Output:
</p>

<ul class="org-ul">
<li>locations of the nodes in space,</li>

<li>tilt angle of spheres for display (optional).</li>
</ul>

<p>
The location optimizer does its calculations under the assumption
that:
</p>

<ul class="org-ul">
<li>the length of a connection is 1,</li>

<li>the angle between connections is the tetrahedral angle (≈ 109.5°).</li>
</ul>

<p>
Note that the information in this document is only relevant for the
version of SAN that was current at the time of publication.
</p>


<div class="figure">
<p><img src="./images/Maker-Faire-Rome-2018.jpg" alt="Maker-Faire-Rome-2018.jpg" />
</p>
<p><span class="figure-number">Figure 1: </span>Dodecahedron built by two little girls at the end of Maker Faire Rome: Convergence successful!</p>
</div>
</div>
</div>

<div id="outline-container-org3e452d5" class="outline-2">
<h2 id="org3e452d5"><span class="section-number-2">2</span> Nodes</h2>
<div class="outline-text-2" id="text-2">

<div class="figure">
<p><img src="./images/geometry.png" alt="geometry.png" />
</p>
<p><span class="figure-number">Figure 2: </span>Geometry of a node with ports 1–4</p>
</div>

<p>
Properties of a node:
</p>

<ul class="org-ul">
<li>A node may also be called a <i>sphere</i>, referring to the physical
elements in the SAN construction kit.</li>

<li>There is one special node, the root node:

<ul class="org-ul">
<li>It connects the computer to the network.</li>

<li>It has one USB port that connects to the computer.</li>

<li>It has only one port: 1</li>

<li>It’s ID is: <code>^</code></li>
</ul></li>

<li>Non-root nodes have four ports: 1, 2, 3, and 4</li>

<li>Each non-root node has a unique ID: A–Z</li>

<li>A node’s <i>axis</i> is relevant if there is information about its tilt
angle. The tilt angle is measured by an accelerometer. As of this
writing there is only one sphere that contains an accelerometer.</li>
</ul>
</div>
</div>

<div id="outline-container-orgc003cf4" class="outline-2">
<h2 id="orgc003cf4"><span class="section-number-2">3</span> Genetic algorithm for location optimization</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-org8e68dc0" class="outline-3">
<h3 id="org8e68dc0"><span class="section-number-3">3.1</span> Summary</h3>
<div class="outline-text-3" id="text-3-1">
<p>
A genetic algorithm is used to approximate the positions of the points
in space. This algorithm is called <i>location optimizer.</i> After
optimization, ideally all neighboring nodes have a distance of 1, and
the angles between the connecting edges match those on the
spheres. The algorithm, however, is flexible enough to find solutions
even if distances or angles have been violated. See examples below.
</p>
</div>
</div>

<div id="outline-container-orgf6b163a" class="outline-3">
<h3 id="orgf6b163a"><span class="section-number-3">3.2</span> Steps</h3>
<div class="outline-text-3" id="text-3-2">
<ol class="org-ol">
<li><p>
<i>Initialize:</i> Generate a population of \(n\) individuals. Each
individual \(i\) is described by a chromosome \(X_i\). A chromosome
contains a list of coordinates. The coordinates describe a
distribution of points in space. Initially the coordinates are
chosen randomly.
</p>

<p>
Example population for a network composed of nodes \(C\), \(B\), and
\(D\):
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">&#xa0;</th>
<th scope="col" class="org-right">\(x_C\)</th>
<th scope="col" class="org-right">\(y_C\)</th>
<th scope="col" class="org-right">\(z_C\)</th>
<th scope="col" class="org-right">\(x_B\)</th>
<th scope="col" class="org-right">\(y_B\)</th>
<th scope="col" class="org-right">\(z_B\)</th>
<th scope="col" class="org-right">\(x_D\)</th>
<th scope="col" class="org-right">\(y_D\)</th>
<th scope="col" class="org-right">\(z_D\)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">\(X_1\)</td>
<td class="org-right">-0.87</td>
<td class="org-right">-0.59</td>
<td class="org-right">0.51</td>
<td class="org-right">0.01</td>
<td class="org-right">-0.18</td>
<td class="org-right">0.92</td>
<td class="org-right">-0.88</td>
<td class="org-right">-0.45</td>
<td class="org-right">-0.61</td>
</tr>

<tr>
<td class="org-left">\(X_2\)</td>
<td class="org-right">0.14</td>
<td class="org-right">0.39</td>
<td class="org-right">0.37</td>
<td class="org-right">0.30</td>
<td class="org-right">-0.61</td>
<td class="org-right">-0.25</td>
<td class="org-right">0.40</td>
<td class="org-right">0.21</td>
<td class="org-right">0.75</td>
</tr>

<tr>
<td class="org-left">\(X_3\)</td>
<td class="org-right">0.40</td>
<td class="org-right">-0.54</td>
<td class="org-right">0.00</td>
<td class="org-right">-0.43</td>
<td class="org-right">0.94</td>
<td class="org-right">0.29</td>
<td class="org-right">0.37</td>
<td class="org-right">0.76</td>
<td class="org-right">-0.74</td>
</tr>

<tr>
<td class="org-left">…</td>
<td class="org-right">&#xa0;</td>
<td class="org-right">&#xa0;</td>
<td class="org-right">&#xa0;</td>
<td class="org-right">&#xa0;</td>
<td class="org-right">&#xa0;</td>
<td class="org-right">&#xa0;</td>
<td class="org-right">&#xa0;</td>
<td class="org-right">&#xa0;</td>
<td class="org-right">&#xa0;</td>
</tr>

<tr>
<td class="org-left">\(X_n\)</td>
<td class="org-right">0.08</td>
<td class="org-right">-1.00</td>
<td class="org-right">0.71</td>
<td class="org-right">-0.68</td>
<td class="org-right">-0.26</td>
<td class="org-right">0.33</td>
<td class="org-right">-0.64</td>
<td class="org-right">0.94</td>
<td class="org-right">0.95</td>
</tr>
</tbody>
</table></li>

<li><i>Reproduce:</i>

<ol class="org-ol">
<li><p>
<i>Pair:</i> Randomly select pairs of individuals. These individuals
will act as parents in the next step.
</p>

<p>
Example pair: \((X_3, X_1)\)
</p></li>

<li><i>Create offspring.</i> For each pair of parents:

<ol class="org-ol">
<li><p>
<i>Crossover:</i> Form a child chromosome by taking one part of
the chromosome from the first parent and the other part from
the second parent.
</p>

<p>
Child created from a crossover of the above example pair:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />
</colgroup>

<colgroup>
<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">\(X_3\): \(x_C\) … \(x_D\)</th>
<th scope="col" class="org-left">\(X_1\): \(y_D\) … \(z_D\)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">0.40 -0.54 0.00 -0.43 0.94 0.29 0.37</td>
<td class="org-left">-0.45 -0.61</td>
</tr>
</tbody>
</table>

<p>
The location of the crossover is random. More than one
crossover may happen, i.e. switching multiple times from the
chromosome of one parent to that of the other.
</p></li>

<li><p>
<i>Mutate:</i> Randomly change coordinates in the child
chromosome.
</p>

<p>
Example mutation of the above child:
</p>

<p>
0.40 -0.54 <b>-1.50</b> -0.43 0.94 0.29 0.37 -0.45 <b>0.40</b>
</p></li>
</ol></li>
</ol></li>

<li><p>
<i>Find fitness:</i> For each child determine how close the coordinates
in the chromosome are to an optimal distribution. An optimal
distribution is one where:
</p>

<ul class="org-ul">
<li>the distance between each two neighboring nodes is 1,</li>

<li>the angle between each two connections from one node is the
tetrahedral angle.</li>
</ul>

<p>
The deviation to the optimal distribution is quantified as fitness
and assigned to each child.
</p></li>

<li><i>Natural selection:</i> Create a new population by combining:

<ul class="org-ul">
<li>the \(n - 1\) best children,</li>

<li>the best individual from the previous generation.</li>
</ul></li>

<li><i>Visualization:</i> Render the best individual in the new population
on screen.</li>

<li><i>Iterate:</i> go to step 2.</li>
</ol>
</div>
</div>

<div id="outline-container-orgf77982f" class="outline-3">
<h3 id="orgf77982f"><span class="section-number-3">3.3</span> Problem</h3>
<div class="outline-text-3" id="text-3-3">
<p>
Genetic algorithms tend to get stuck in local minima. In that case all
individuals have converged close to the same non-optimal
solution. Mutation of single coordinates worsen the fitness of an
individual. Therefore, differing individuals don’t carry over to the
next generation. Evolution has stopped.
</p>
</div>
</div>

<div id="outline-container-org0c16aea" class="outline-3">
<h3 id="org0c16aea"><span class="section-number-3">3.4</span> Fitness</h3>
<div class="outline-text-3" id="text-3-4">
<p>
Fitness is a measure for the deviation from the optimum. But how do we
calculate the deviation if we don’t know the optimum? Let’s see!
</p>

<p>
The idea is to calculate the deviation from the optimum for each node,
then sum all deviations. What follows is an example for node \(A\) with
a full set of neighbors, \(B\), \(C\), \(D\), and \(E\).
</p>


<div class="figure">
<p><img src="./images/fitness.png" alt="fitness.png" />
</p>
</div>

<p>
In this example, the connections for node \(A\) are:
</p>

<ul class="org-ul">
<li>Connection 1: port 4 connected to node \(B\) (yellow)</li>

<li>Connection 2: port 1 connected to node \(E\) (blue)</li>

<li>Connection 3: port 3 connected to node \(D\) (aqua)</li>

<li>Connection 4: port 2 connected to node \(C\) (lime)</li>
</ul>
</div>

<div id="outline-container-org55e0321" class="outline-4">
<h4 id="org55e0321"><span class="section-number-4">3.4.1</span> Deviation of first neighbor</h4>
<div class="outline-text-4" id="text-3-4-1">
<p>
Correct neighbor locations lie on a sphere of radius 1. As the
location of the <i>expected neighbor</i> \(1'\), we take the point that is
closest to the location of the existing neighbor \(1\) (deviation
highlighted in red):
</p>


<div class="figure">
<p><img src="./images/fitness-1.png" alt="fitness-1.png" />
</p>
</div>

<p>
The deviation is the difference between the two locations:
</p>

<p>
\(D_{A,1} = 0.50\)
</p>
</div>
</div>

<div id="outline-container-org38f9eed" class="outline-4">
<h4 id="org38f9eed"><span class="section-number-4">3.4.2</span> Deviation of second neighbor</h4>
<div class="outline-text-4" id="text-3-4-2">
<p>
Correct neighbor locations are at the tedrahedral angle to the edge
connecting the node and its first expected neighbor \(1'\). In addition,
correct neighbor locations are required to have a distance of 1 from
the center. Therefore, the set of all correct locations lies on a
circle. As the location of the expected neighbor \(2'\) we select from
this set the point that is closest to the exising neighbor \(2\).
</p>


<div class="figure">
<p><img src="./images/fitness-2.png" alt="fitness-2.png" />
</p>
</div>

<p>
Deviation:
</p>

<p>
\(D_{A,2} = 0.28\)
</p>
</div>
</div>

<div id="outline-container-orge5bfeab" class="outline-4">
<h4 id="orge5bfeab"><span class="section-number-4">3.4.3</span> Deviations of third and fourth neighbor</h4>
<div class="outline-text-4" id="text-3-4-3">
<p>
Based on the locations of the first two expected neighbors \(1'\) and
\(2'\), we can calculate the locations of the remaining expected
neighbors \(3'\) and \(4'\).
</p>


<div class="figure">
<p><img src="./images/fitness-3-4.png" alt="fitness-3-4.png" />
</p>
</div>

<p>
Deviations:
</p>

<p>
\(D_{A,3} = 0.49, D_{A,4} = 0.63\)
</p>
</div>
</div>

<div id="outline-container-org1e046fc" class="outline-4">
<h4 id="org1e046fc"><span class="section-number-4">3.4.4</span> Total deviation</h4>
<div class="outline-text-4" id="text-3-4-4">
<p>
Now we can calculate the total deviation of all the neighbors of the
node:
</p>

<p>
\(D_A = D_{A,1} + D_{A,2} + D_{A,3} + D_{A,4} = 1.90\)
</p>

<p>
After the deviation has been calculated for every node, the total
deviation can be calculated. For a network with nodes \(A\), \(B\), \(C\),
\(D\), and \(E\) that would be:
</p>

<p>
\(D = D_A + D_B + D_C + D_D + D_E\)
</p>

<p>
To get the fitness \(F\) of the current chromosome, we simply reverse
the sign:
</p>

<p>
\(F = -D\)
</p>

<p>
As the value of the deviations is negative, it holds that: The higher
the fitness, the closer the individual is to an optimal solution.
</p>
</div>
</div>

<div id="outline-container-org94ca9b7" class="outline-4">
<h4 id="org94ca9b7"><span class="section-number-4">3.4.5</span> Note about the positions of the third and fourth neighbor</h4>
<div class="outline-text-4" id="text-3-4-5">
<p>
Note that for calculating the positions of connections 3 and 4, the
position of the ports is relevant. Take a look at the following two
structures. They are not identical!
</p>


<div class="figure">
<p><img src="./images/1-4-structure-comparison.png" alt="1-4-structure-comparison.png" />
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org1d938b1" class="outline-3">
<h3 id="org1d938b1"><span class="section-number-3">3.5</span> Alternative fitness proposal</h3>
<div class="outline-text-3" id="text-3-5">
<p>
The following proposal creates the fitness based on the sum of
independent terms. The terms may possibly be multiplied by
weights. With the first two terms, this fitness has been used as cost
function in David’s <a href="https://github.com/davidblitz/san-optimizer">San-Optimizer</a> based on the gradient descend
algorithm.
</p>
</div>

<div id="outline-container-orge20ccc3" class="outline-4">
<h4 id="orge20ccc3"><span class="section-number-4">3.5.1</span> Distance</h4>
<div class="outline-text-4" id="text-3-5-1">
\begin{equation}
F_D = \sum_{n=1}^N (l_n^2 - 1)^2
\end{equation}

<p>
Where:
</p>

<ul class="org-ul">
<li>\(N\): number of all edges</li>

<li>\(l_n\): length of edge \(n\)</li>
</ul>

<p>
\(1\) is the expected distance.
</p>
</div>
</div>

<div id="outline-container-orge4f0247" class="outline-4">
<h4 id="orge4f0247"><span class="section-number-4">3.5.2</span> Angle</h4>
<div class="outline-text-4" id="text-3-5-2">
\begin{equation}
F_A = \sum_{n=1}^N \sum_{i=1}^{I_n} \sum_{j=1\\j≠i}^{I_n} (\vec{v}_{n,i}
⋅ \vec{v}_{n,j} + ⅓)^2
\end{equation}

<p>
Where:
</p>

<ul class="org-ul">
<li>\(N\): number of nodes</li>

<li>\(I_n\): number of neighbors attached to node number \(n\)</li>

<li>\(v_{n,i}\): vector connecting node number \(n\) to neighbor number \(i\)</li>
</ul>

<p>
\(-⅓\) is the cosine of the required tedrahedral angle.
</p>

<p>
Note that the vectors are not normalized. Nevertheless optimization
works in David’s implementation.
</p>
</div>
</div>

<div id="outline-container-org7ae6075" class="outline-4">
<h4 id="org7ae6075"><span class="section-number-4">3.5.3</span> Chirality</h4>
<div class="outline-text-4" id="text-3-5-3">
\begin{equation}
F_C =
    \sum_{n=1}^L \Big((\vec{v}_{n,1} × \vec{v}_{n,2}) ⋅ \vec{v}_{n,3} -
    cos\big(\frac{π}{2} - \frac{1}{2} arccos(-⅓)\big)\Big)^2 + \\
    \sum_{n=1}^R \Big((\vec{v}_{n,1} × \vec{v}_{n,2}) ⋅ \vec{v}_{n,3} -
    cos\big(\frac{π}{2} + \frac{1}{2} arccos(-⅓)\big)\Big)^2
\end{equation}

<p>
Where:
</p>

<ul class="org-ul">
<li>\(L\): number of nodes with left handed chirality</li>

<li>\(R\): number of nodes with right handed chirality</li>

<li>\(v_{n,i}\): normalized vector connecting node number \(n\) to its
neighbor number \(i\)</li>
</ul>

<p>
Only nodes with at least three neighbors are included. The other nodes
don’t have chirality.
</p>
</div>
</div>

<div id="outline-container-orgd1b716f" class="outline-4">
<h4 id="orgd1b716f"><span class="section-number-4">3.5.4</span> Total fitness</h4>
<div class="outline-text-4" id="text-3-5-4">
<p>
The total fitness is:
</p>

\begin{equation}
F = -(w_D F_D + w_A F_A + w_C F_C)
\end{equation}

<p>
Where \(w_i\) are weights.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-orgd84a87c" class="outline-2">
<h2 id="orgd84a87c"><span class="section-number-2">4</span> Simulation</h2>
<div class="outline-text-2" id="text-4">
<p>
Assembling the structure can be simulated. This is useful for testing
the location optimizer without the physical construction kit.
</p>

<p>
Setup:
</p>

<ol class="org-ol">
<li>Install Node.js and the Yarn package manager.</li>

<li>Clone the SAN repository from: <a href="https://github.com/feklee/san/">https://github.com/feklee/san/</a></li>

<li><p>
Install all necessary dependencies and build the frontend (on
Windows call <code>rollup.cmd</code> instead of <code>rollup</code>):
</p>

<div class="org-src-container">
<pre class="src src-shell">$ cd webapp
$ yarn install
$ ./node_modules/.bin/rollup --config
</pre>
</div></li>

<li><p>
Start the simulation:
</p>

<div class="org-src-container">
<pre class="src src-shell">yarn start simulate
</pre>
</div></li>

<li><p>
Open the SAN web app: <a href="http://localhost:8080">http://localhost:8080</a>
</p>


<div class="figure">
<p><img src="./images/webapp-with-no-node.png" alt="webapp-with-no-node.png" />
</p>
</div>

<p>
To navigate in 3D in the canvas on the left side, use the mouse.
</p></li>

<li><p>
Go back to the command line and connect a node to the root node:
</p>

<div class="org-src-container">
<pre class="src src-text">+^1C1
</pre>
</div>

<p>
This connects port <code>C1</code> (port 1 on node C) with <code>^1</code> (port 1 on the
root node). The result is immediately visible in the web app.
</p>


<div class="figure">
<p><img src="./images/webapp-with-one-node.png" alt="webapp-with-one-node.png" />
</p>
</div>

<p>
On the top right side you see an adjacency matrix. The numbers in
the matrix refer to the connected ports. On the bottom right side
you see a log of the information that the webapp receives from the
structure. Each line begins with a timestamp. The circle on the
right means that there is no information about a tilt angle for the
connected node.
</p></li>

<li><p>
Add additional nodes:
</p>

<div class="org-src-container">
<pre class="src src-text">+C2B1
+B3D4
</pre>
</div>

<p>
This connects <code>B3</code> (port 3 on node B) to <code>C2</code> and <code>D4</code> to <code>B3</code>.
</p>


<div class="figure">
<p><img src="./images/webapp-with-three-nodes.png" alt="webapp-with-three-nodes.png" />
</p>
</div></li>
</ol>
</div>
</div>

<div id="outline-container-org051b1dd" class="outline-2">
<h2 id="org051b1dd"><span class="section-number-2">5</span> Experimentation</h2>
<div class="outline-text-2" id="text-5">
<p>
For experimentation, custom locations may be assigned to nodes.
</p>

<ol class="org-ol">
<li>Open the SAN web app.</li>

<li>Make sure that you see the network that you want to work with.</li>

<li>Open your browser’s JavaScript console.</li>

<li><p>
Stop the location optimizer:
</p>

<div class="org-src-container">
<pre class="src src-js">locationOptimizer.stop();
</pre>
</div></li>

<li><p>
Assign the locations, for example:
</p>

<div class="org-src-container">
<pre class="src src-js">locationOptimizer.setLocations({
    A: [0, 0, 0],
    B: [1, 0, 0],
    C: [1, 1, 0],
    D: [0, 1, 0]
});
</pre>
</div></li>

<li><p>
Optionally, update the locations in the location optimizer and
resume optimization:
</p>

<div class="org-src-container">
<pre class="src src-js">locationOptimizer.update();
locationOptimizer.run();
</pre>
</div>

<p>
Caution: If your locations cannot compete with the locations in the
current population, you will not see them in the next
generation. They will disappear immediately.
</p></li>
</ol>
</div>
</div>

<div id="outline-container-org1ec70c6" class="outline-2">
<h2 id="org1ec70c6"><span class="section-number-2">6</span> Examples</h2>
<div class="outline-text-2" id="text-6">
</div>
<div id="outline-container-orgf8b7067" class="outline-3">
<h3 id="orgf8b7067"><span class="section-number-3">6.1</span> 1:1</h3>
<div class="outline-text-3" id="text-6-1">
<p>
Just two nodes are connected.
</p>
</div>

<div id="outline-container-org3db42db" class="outline-4">
<h4 id="org3db42db"><span class="section-number-4">6.1.1</span> Input</h4>
<div class="outline-text-4" id="text-6-1-1">
<p>
Simulation:
</p>

<div class="org-src-container">
<pre class="src src-text">+^1A1
+A2B1
</pre>
</div>


<div class="figure">
<p><img src="./images/1-1-input.png" alt="1-1-input.png" />
</p>
</div>

<p>
Adjacency matrix (numbers are ports): <a href="./data/1-1-adjacency.tsv">1-1-adjacency.tsv</a>
</p>
</div>
</div>

<div id="outline-container-orge08435f" class="outline-4">
<h4 id="orge08435f"><span class="section-number-4">6.1.2</span> Example solution</h4>
<div class="outline-text-4" id="text-6-1-2">

<div class="figure">
<p><img src="./images/1-1.png" alt="1-1.png" />
</p>
</div>

<p>
Coordinates: <a href="./data/1-1-coordinates.tsv">1-1-coordinates.tsv</a>
</p>
</div>
</div>
</div>

<div id="outline-container-orgf20f436" class="outline-3">
<h3 id="orgf20f436"><span class="section-number-3">6.2</span> 1:4</h3>
<div class="outline-text-3" id="text-6-2">
<p>
One node has all of its four neighbors connected.
</p>
</div>

<div id="outline-container-org561e255" class="outline-4">
<h4 id="org561e255"><span class="section-number-4">6.2.1</span> Input</h4>
<div class="outline-text-4" id="text-6-2-1">
<p>
Simulation:
</p>

<div class="org-src-container">
<pre class="src src-text">+^1B2
+B1A1
+A2C1
+A3D1
+A4E1
</pre>
</div>


<div class="figure">
<p><img src="./images/1-4-input.png" alt="1-4-input.png" />
</p>
</div>

<p>
Adjacency matrix (numbers are ports): <a href="./data/1-4-adjacency.tsv">1-4-adjacency.tsv</a>
</p>
</div>
</div>

<div id="outline-container-org66f572b" class="outline-4">
<h4 id="org66f572b"><span class="section-number-4">6.2.2</span> Example solution</h4>
<div class="outline-text-4" id="text-6-2-2">

<div class="figure">
<p><img src="./images/1-4.png" alt="1-4.png" />
</p>
</div>

<p>
Coordinates: <a href="./data/1-4-coordinates.tsv">1-4-coordinates.tsv</a>
</p>
</div>
</div>
</div>

<div id="outline-container-org17c22b6" class="outline-3">
<h3 id="org17c22b6"><span class="section-number-3">6.3</span> Hexagon</h3>
<div class="outline-text-3" id="text-6-3">
<p>
This is the smallest loop that can be built without violating the
tetrahedral angles.
</p>
</div>

<div id="outline-container-orga07c9dd" class="outline-4">
<h4 id="orga07c9dd"><span class="section-number-4">6.3.1</span> Input</h4>
<div class="outline-text-4" id="text-6-3-1">
<p>
Simulation:
</p>

<div class="org-src-container">
<pre class="src src-text">+^1A1
+A2B1
+B2C1
+C2D1
+D2E1
+E2F1
+F2A3
</pre>
</div>


<div class="figure">
<p><img src="./images/hexagon-input.png" alt="hexagon-input.png" />
</p>
</div>

<p>
Adjacency matrix (numbers are ports): <a href="./data/hexagon-adjacency.tsv">hexagon-adjacency.tsv</a>
</p>
</div>
</div>

<div id="outline-container-orgb182968" class="outline-4">
<h4 id="orgb182968"><span class="section-number-4">6.3.2</span> Example solution</h4>
<div class="outline-text-4" id="text-6-3-2">

<div class="figure">
<p><img src="./images/hexagon.png" alt="hexagon.png" />
</p>
</div>

<p>
Coordinates: <a href="./data/hexagon-coordinates.tsv">hexagon-coordinates.tsv</a>
</p>
</div>
</div>
</div>

<div id="outline-container-org8fd49a4" class="outline-3">
<h3 id="org8fd49a4"><span class="section-number-3">6.4</span> Pentagon</h3>
<div class="outline-text-3" id="text-6-4">
<p>
Note that the interior angles of a pentagon are 108°. That is close to
but not identical to the tetrahedral angle of 109.5°. Nevertheless the
algorithm is able to approximate a solution. Even for nodes connected
in a triangle it finds a solution!
</p>
</div>

<div id="outline-container-org1416f1f" class="outline-4">
<h4 id="org1416f1f"><span class="section-number-4">6.4.1</span> Input</h4>
<div class="outline-text-4" id="text-6-4-1">
<p>
Simulation:
</p>

<div class="org-src-container">
<pre class="src src-text">+^1A1
+A2B1
+B2C1
+C2D1
+D2E1
+E2A3
</pre>
</div>


<div class="figure">
<p><img src="./images/pentagon-input.png" alt="pentagon-input.png" />
</p>
</div>

<p>
Adjacency matrix (numbers are ports): <a href="./data/pentagon-adjacency.tsv">pentagon-adjacency.tsv</a>
</p>
</div>
</div>

<div id="outline-container-orgd82baea" class="outline-4">
<h4 id="orgd82baea"><span class="section-number-4">6.4.2</span> Example solution</h4>
<div class="outline-text-4" id="text-6-4-2">

<div class="figure">
<p><img src="./images/pentagon.png" alt="pentagon.png" />
</p>
</div>

<p>
Coordinates: <a href="./data/pentagon-coordinates.tsv">pentagon-coordinates.tsv</a>
</p>
</div>
</div>
</div>

<div id="outline-container-org56304e1" class="outline-3">
<h3 id="org56304e1"><span class="section-number-3">6.5</span> Dodecahedron</h3>
<div class="outline-text-3" id="text-6-5">
<p>
The dodecahedron consists of twelve pentagon sufaces. There are 20
unknown edges, i.e. nodes in the network. This means 60 variables have
to be found.
</p>
</div>

<div id="outline-container-org0e4acd8" class="outline-4">
<h4 id="org0e4acd8"><span class="section-number-4">6.5.1</span> Input</h4>
<div class="outline-text-4" id="text-6-5-1">
<p>
Simulation:
</p>

<div class="org-src-container">
<pre class="src src-text">+^1A4
+A1B2
+A2E1
+A3F1
+B1C2
+B3H1
+C1D2
+C3J1
+D1E2
+D3L1
+E3N1
+F2O2
+F3G3
+G1P1
+G2H2
+H3I3
+I1Q1
+I2J2
+J3K3
+K1R1
+K2L2
+L3M3
+M1S1
+M2N2
+N3O3
+O1T1
+P2T3
+P3Q2
+Q3R2
+R3S2
+S3T2
</pre>
</div>


<div class="figure">
<p><img src="./images/dodecahedron-input.png" alt="dodecahedron-input.png" />
</p>
</div>

<p>
Adjacency matrix (numbers are ports): <a href="./data/dodecahedron-adjacency.tsv">dodecahedron-adjacency.tsv</a>
</p>
</div>
</div>

<div id="outline-container-org3ec0bcc" class="outline-4">
<h4 id="org3ec0bcc"><span class="section-number-4">6.5.2</span> Example solution</h4>
<div class="outline-text-4" id="text-6-5-2">

<div class="figure">
<p><img src="./images/dodecahedron.png" alt="dodecahedron.png" />
</p>
</div>

<p>
Coordinates: <a href="./data/dodecahedron-coordinates.tsv">dodecahedron-coordinates.tsv</a>
</p>
</div>
</div>

<div id="outline-container-orgae34f65" class="outline-4">
<h4 id="orgae34f65"><span class="section-number-4">6.5.3</span> Example bad solution</h4>
<div class="outline-text-4" id="text-6-5-3">
<p>
In most runs, at least nine out of ten times, the genetic algorithm
does not find a good solution. It gets stuck in a local minimum.
</p>


<div class="figure">
<p><img src="./images/dodecahedron-failure.png" alt="dodecahedron-failure.png" />
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org437493a" class="outline-3">
<h3 id="org437493a"><span class="section-number-3">6.6</span> Dodecahedron with tilt angles</h3>
<div class="outline-text-3" id="text-6-6">
<p>
Tilt angles provide additional information. The idea is to reduce the
space of unknown variables from 60 to 40, thereby making it easier to
find a solution. On the other hand, calculation of fitness is more
cumbersome and, at least in the current implementation, more time
consuming.
</p>

<p>
Results have been mixed. In fact it looks like convergence now is
almost unachievable.
</p>

<p>
Another purpose for tilt information is to get a more accurate
represantation of what the user actually built. Without tilt
information, for example, the displayed structure may be upside down
compared to what the user sees sitting on the table.
</p>
</div>

<div id="outline-container-orge625876" class="outline-4">
<h4 id="orge625876"><span class="section-number-4">6.6.1</span> Input</h4>
<div class="outline-text-4" id="text-6-6-1">
<p>
Simulation (<code>/A92</code> sets the tilt angle of node \(A\) to 92°):
</p>

<div class="org-src-container">
<pre class="src src-text">+^1A4
+A1B2
+A2E1
+A3F1
+B1C2
+B3H1
+C1D2
+C3J1
+D1E2
+D3L1
+E3N1
+F2O2
+F3G3
+G1P1
+G2H2
+H3I3
+I1Q1
+I2J2
+J3K3
+K1R1
+K2L2
+L3M3
+M1S1
+M2N2
+N3O3
+O1T1
+P2T3
+P3Q2
+Q3R2
+R3S2
+S3T2
/A92
/B92
/C92
/D92
/E92
/F107
/G73
/H107
/I73
/J107
/K73
/L107
/M73
/N107
/O73
/P135
/Q135
/R135
/S135
/T135
</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Felix E. Klee</p>
<p class="date">Created: 2019-01-22 Tue 12:42</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
